<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>WHITE_HACKER | Pixel MiniQuest</title>
  <style>
    :root{
      --shell:#d6d1c6;
      --shell2:#b9b2a5;
      --frame1:#3b3b3b;
      --frame2:#232323;
      --screen1:#142014;
      --screen2:#1c2b1c;
      --pix:#c9ffb8;
      --pixDim:rgba(201,255,184,.72);
      --red:#b33831;
      --blue:#5d60ed;
      --purple:#9b5de5;
      --green:#38b764;
      --yellow:#f4b41a;
      --mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      display:grid;
      place-items:center;
      font-family:var(--mono);
      background:
        radial-gradient(1100px 600px at 50% -10%, rgba(255,255,255,.55), transparent),
        linear-gradient(180deg, #f3f2ee, #e8e4dc);
      padding:14px;
      overflow-x:hidden;
    }

    .wrap{width:min(480px,100%); filter:drop-shadow(0 18px 50px rgba(0,0,0,.18));}
    .gb{
      background:linear-gradient(180deg,var(--shell),var(--shell2));
      border-radius:26px;
      padding:14px;
      border:1px solid rgba(0,0,0,.10);
    }
    .top{
      display:flex; align-items:center; justify-content:space-between;
      padding:4px 6px 10px;
      color:rgba(0,0,0,.6); font-weight:800; font-size:11px;
    }
    .badge{
      display:flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px;
      background:rgba(255,255,255,.55);
      border:1px solid rgba(0,0,0,.08);
    }
    .dot{width:8px;height:8px;border-radius:50%;background:#77d36a;box-shadow:0 0 14px rgba(120,255,120,.45)}
    .coin-display{
      display:flex;align-items:center;gap:4px;
      color:#fff;font-weight:900;
      background:linear-gradient(180deg,#f4b41a,#d49000);
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.15);
      text-shadow:1px 1px 0 rgba(0,0,0,.3);
    }

    .frame{
      background:linear-gradient(180deg,var(--frame1),var(--frame2));
      border-radius:20px;
      padding:10px;
      border:1px solid rgba(255,255,255,.08);
    }
    .screen{
      position:relative;
      border-radius:12px;
      border:2px solid rgba(0,0,0,.45);
      background:
        radial-gradient(600px 300px at 50% 0%, rgba(120,255,120,.10), transparent 60%),
        linear-gradient(180deg,var(--screen1),var(--screen2));
      overflow:hidden;
    }
    .screen::before{
      content:"";
      position:absolute; inset:0;
      background: repeating-linear-gradient(180deg,
        rgba(0,0,0,.08), rgba(0,0,0,.08) 1px,
        transparent 3px, transparent 6px);
      mix-blend-mode:multiply;
      pointer-events:none;
      opacity:.35;
      z-index:2;
    }

    canvas{
      width:100%;
      aspect-ratio: 320 / 320;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      display:block;
    }

    .controls{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:8px;
      margin-top:10px;
    }
    .btn{
      padding:14px 8px;
      border-radius:12px;
      border:none;
      color:#fff;
      font-family:var(--mono);
      font-weight:900;
      font-size:10px;
      cursor:pointer;
      transition: all 0.2s;
    }
    .btn:active{transform:translateY(2px)}
    .btn:disabled{opacity:0.35;cursor:not-allowed;transform:none}
    .btn-start{background:linear-gradient(180deg,var(--red),#8b2525)}
    .btn-profile{background:linear-gradient(180deg,var(--blue),#4040b0)}
    .btn-photo{background:linear-gradient(180deg,var(--purple),#7040a0)}
    .btn-next{background:linear-gradient(180deg,var(--green),#208040)}

    .mini{
      display:flex; justify-content:space-between;
      margin-top:10px;
      font-size:10px;
      color:rgba(0,0,0,.5);
    }
    .pill{
      padding:8px 12px;
      border-radius:999px;
      background:rgba(255,255,255,.5);
      border:1px solid rgba(0,0,0,.1);
      cursor:pointer;
      font-weight:800;
    }
    .pill:active{transform:translateY(1px)}

    /* Dialog */
    .dlg{
      position:absolute;
      left:10px; right:10px; bottom:10px;
      border-radius:12px;
      padding:12px;
      background:rgba(0,0,0,.7);
      color:var(--pix);
      font-family:var(--mono);
      display:none;
      z-index:10;
      border:2px solid rgba(201,255,184,.25);
    }
    .dlg.show{display:block}
    .dlg .title{font-weight:900;font-size:12px;margin-bottom:6px}
    .dlg .body{font-size:11px;line-height:1.6;color:var(--pixDim);white-space:pre-wrap;margin:0}
    .dlg .row{display:flex;gap:8px;margin-top:10px}
    .dlg input{
      flex:1;
      padding:10px;
      border-radius:8px;
      border:1px solid rgba(201,255,184,.3);
      background:rgba(0,0,0,.4);
      color:var(--pix);
      font-family:var(--mono);
      font-weight:700;
    }
    .dlg .dBtn{
      padding:10px 14px;
      border-radius:8px;
      border:none;
      background:var(--green);
      color:#fff;
      font-weight:900;
      cursor:pointer;
    }
    .dlg .hint{margin-top:8px;font-size:10px;color:rgba(201,255,184,.6)}
    .dlg .close{
      position:absolute;top:8px;right:8px;
      width:28px;height:28px;
      border-radius:8px;
      background:rgba(0,0,0,.4);
      border:1px solid rgba(201,255,184,.2);
      color:var(--pix);
      display:grid;place-items:center;
      cursor:pointer;font-weight:900;
    }

    /* Loading bar */
    .loadWrap{
      height:10px;
      border-radius:999px;
      background:rgba(0,0,0,.4);
      overflow:hidden;
      margin-top:10px;
      display:none;
    }
    .loadWrap.show{display:block}
    .loadBar{height:100%;width:0%;background:linear-gradient(90deg,rgba(120,255,120,.3),var(--green));transition:width .1s}

    /* Coin popup */
    .coin-popup{
      position:absolute;
      font-size:14px;
      font-weight:900;
      color:var(--yellow);
      text-shadow:0 0 10px var(--yellow);
      pointer-events:none;
      animation:coinUp 1.5s forwards;
      z-index:20;
    }
    @keyframes coinUp{
      0%{opacity:1;transform:translateY(0)}
      100%{opacity:0;transform:translateY(-40px)}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="gb">
      <div class="top">
        <div class="badge"><span class="dot"></span><span>WHITE_HACKER</span></div>
        <div class="coin-display">ğŸª™ <span id="coinCount">0</span></div>
      </div>

      <div class="frame">
        <div class="screen" id="screenWrap">
          <canvas id="cv" width="320" height="320"></canvas>

          <div class="dlg" id="dlg">
            <div class="close" id="dlgClose">âœ•</div>
            <div class="title" id="dlgTitle">TITLE</div>
            <pre class="body" id="dlgBody"></pre>
            <div class="row" id="dlgRow" style="display:none">
              <input id="dlgInput" type="text" placeholder="ì…ë ¥..." autocomplete="off">
              <button class="dBtn" id="dlgSubmit">OK</button>
            </div>
            <div class="hint" id="dlgHint"></div>
            <div class="loadWrap" id="loadWrap"><div class="loadBar" id="loadBar"></div></div>
          </div>
        </div>
      </div>

      <div class="controls">
        <button class="btn btn-start" id="btnStart">ğŸšª START</button>
        <button class="btn btn-profile" id="btnProfile" disabled>ğŸ“‹ PROFILE</button>
        <button class="btn btn-photo" id="btnPhoto" disabled>ğŸ“¸ PHOTO</button>
        <button class="btn btn-next" id="btnNext" disabled>ğŸš€ NEXT</button>
      </div>

      <div class="mini">
        <span id="statusText">STARTë¥¼ í´ë¦¬ì–´í•˜ì„¸ìš”</span>
        <span class="pill" id="btnReset">RESET</span>
      </div>
    </div>
  </div>

<script>
(function(){
  const cv = document.getElementById('cv');
  const ctx = cv.getContext('2d');
  const W = 320, H = 320;
  const TILE = 40;
  const COLS = 8, ROWS = 8;

  // State
  const st = {
    startCleared: localStorage.getItem('wh_start') === '1',
    photoCleared: localStorage.getItem('wh_photo') === '1',
    coins: parseInt(localStorage.getItem('wh_coins') || '0')
  };
  function saveState(){
    localStorage.setItem('wh_start', st.startCleared ? '1' : '0');
    localStorage.setItem('wh_photo', st.photoCleared ? '1' : '0');
    localStorage.setItem('wh_coins', st.coins);
  }

  // Room positions (tile coords)
  const rooms = {
    start:   {x:1, y:1, icon:'ğŸšª', color:'#b33831'},
    profile: {x:6, y:1, icon:'ğŸ“‹', color:'#5d60ed'},
    photo:   {x:1, y:6, icon:'ğŸ“¸', color:'#9b5de5'},
    next:    {x:6, y:6, icon:'ğŸš€', color:'#38b764'}
  };

  // Player
  const player = {
    x: 4 * TILE,
    y: 3 * TILE,
    tx: 4, ty: 3,
    dir: 'down',
    frame: 0
  };

  let moving = false;
  let path = [];
  let onArrive = null;
  let frameCount = 0;

  // Pixel character (hood + glasses)
  const charColors = {
    hood: '#566c86',
    skin: '#f4cca1',
    glass: '#1a1c2c',
    shirt: '#5d60ed',
    pants: '#333c57'
  };

  function drawChar(px, py, dir, frame){
    const s = 3; // pixel size
    const ox = px + 8, oy = py;

    // Simple front-facing character
    ctx.fillStyle = charColors.hood;
    // Hood
    for(let i=0;i<6;i++) ctx.fillRect(ox+i*s, oy, s, s);
    for(let i=-1;i<7;i++) ctx.fillRect(ox+i*s, oy+s, s, s);
    for(let i=-1;i<7;i++) ctx.fillRect(ox+i*s, oy+s*2, s, s);

    // Face
    ctx.fillStyle = charColors.skin;
    for(let i=0;i<4;i++) ctx.fillRect(ox+i*s+s, oy+s*3, s, s);
    for(let i=0;i<4;i++) ctx.fillRect(ox+i*s+s, oy+s*4, s, s);

    // Glasses
    ctx.fillStyle = charColors.glass;
    ctx.fillRect(ox+s, oy+s*3, s, s);
    ctx.fillRect(ox+s*4, oy+s*3, s, s);
    ctx.fillRect(ox+s*2, oy+s*3, s*2, Math.floor(s/2));

    // Body
    ctx.fillStyle = charColors.shirt;
    for(let i=0;i<6;i++) ctx.fillRect(ox+i*s, oy+s*5, s, s);
    for(let i=0;i<6;i++) ctx.fillRect(ox+i*s, oy+s*6, s, s);

    // Laptop in hands
    ctx.fillStyle = '#333';
    ctx.fillRect(ox+s, oy+s*6+2, s*4, s-1);
    ctx.fillStyle = '#6af';
    ctx.fillRect(ox+s+1, oy+s*6+3, s*4-2, s-3);

    // Legs with walk animation
    ctx.fillStyle = charColors.pants;
    const legOffset = moving ? (frame % 2 === 0 ? 2 : -2) : 0;
    ctx.fillRect(ox+s, oy+s*7, s, s);
    ctx.fillRect(ox+s*4, oy+s*7, s, s);
    if(moving){
      ctx.fillRect(ox+s+legOffset, oy+s*8, s, s);
      ctx.fillRect(ox+s*4-legOffset, oy+s*8, s, s);
    } else {
      ctx.fillRect(ox+s, oy+s*8, s, s);
      ctx.fillRect(ox+s*4, oy+s*8, s, s);
    }

    // Shadow
    ctx.fillStyle = 'rgba(0,0,0,.2)';
    ctx.fillRect(ox, oy+s*9, s*6, 2);
  }

  // Draw room tile
  function drawRoom(room, name){
    const px = room.x * TILE;
    const py = room.y * TILE;
    const locked = !st.startCleared && name !== 'start';

    // Tile background
    ctx.fillStyle = locked ? '#1a1c2c' : 'rgba(201,255,184,.08)';
    ctx.fillRect(px+2, py+2, TILE-4, TILE-4);

    // Border
    ctx.strokeStyle = locked ? 'rgba(201,255,184,.15)' : room.color;
    ctx.lineWidth = 2;
    ctx.strokeRect(px+2, py+2, TILE-4, TILE-4);

    // Icon
    ctx.font = locked ? '16px sans-serif' : '20px sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillStyle = locked ? 'rgba(201,255,184,.3)' : 'rgba(255,255,255,.9)';
    ctx.fillText(locked ? 'ğŸ”’' : room.icon, px + TILE/2, py + TILE/2);

    // Label
    ctx.font = '8px monospace';
    ctx.fillStyle = locked ? 'rgba(201,255,184,.3)' : 'rgba(201,255,184,.8)';
    ctx.fillText(name.toUpperCase(), px + TILE/2, py + TILE - 6);
  }

  // Draw decorative floor tiles
  function drawFloor(){
    ctx.fillStyle = '#0d1a0d';
    ctx.fillRect(0, 0, W, H);

    for(let y=0; y<ROWS; y++){
      for(let x=0; x<COLS; x++){
        const dark = (x + y) % 2 === 0;
        ctx.fillStyle = dark ? '#142014' : '#1a2a1a';
        ctx.fillRect(x*TILE+1, y*TILE+1, TILE-2, TILE-2);
      }
    }
  }

  // Draw coin
  function drawCoin(x, y){
    const bounce = Math.sin(frameCount / 10) * 3;
    ctx.font = '16px sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('ğŸª™', x, y + bounce);
  }

  // Simple pathfinding (straight lines)
  function findPath(fromX, fromY, toX, toY){
    const p = [];
    let cx = fromX, cy = fromY;
    while(cx !== toX){
      cx += (toX > cx) ? 1 : -1;
      p.push({x: cx, y: cy});
    }
    while(cy !== toY){
      cy += (toY > cy) ? 1 : -1;
      p.push({x: cx, y: cy});
    }
    return p;
  }

  function walkTo(room, callback){
    if(moving) return;
    path = findPath(player.tx, player.ty, room.x, room.y);
    if(path.length === 0){
      callback && callback();
      return;
    }
    moving = true;
    onArrive = callback;
  }

  function updateMovement(){
    if(!moving || path.length === 0) return;

    const target = path[0];
    const tx = target.x * TILE;
    const ty = target.y * TILE;
    const speed = 4;

    // Direction
    if(tx > player.x) player.dir = 'right';
    else if(tx < player.x) player.dir = 'left';
    else if(ty > player.y) player.dir = 'down';
    else if(ty < player.y) player.dir = 'up';

    // Move
    if(player.x < tx) player.x = Math.min(player.x + speed, tx);
    else if(player.x > tx) player.x = Math.max(player.x - speed, tx);
    if(player.y < ty) player.y = Math.min(player.y + speed, ty);
    else if(player.y > ty) player.y = Math.max(player.y - speed, ty);

    // Arrived at waypoint
    if(player.x === tx && player.y === ty){
      player.tx = target.x;
      player.ty = target.y;
      path.shift();

      if(path.length === 0){
        moving = false;
        onArrive && onArrive();
        onArrive = null;
      }
    }
  }

  // Dialog
  const dlg = document.getElementById('dlg');
  const dlgTitle = document.getElementById('dlgTitle');
  const dlgBody = document.getElementById('dlgBody');
  const dlgRow = document.getElementById('dlgRow');
  const dlgInput = document.getElementById('dlgInput');
  const dlgSubmit = document.getElementById('dlgSubmit');
  const dlgHint = document.getElementById('dlgHint');
  const dlgClose = document.getElementById('dlgClose');
  const loadWrap = document.getElementById('loadWrap');
  const loadBar = document.getElementById('loadBar');

  function openDlg(title, body, hint=''){
    dlgTitle.textContent = title;
    dlgBody.textContent = body;
    dlgHint.textContent = hint;
    dlgRow.style.display = 'none';
    loadWrap.classList.remove('show');
    dlg.classList.add('show');
  }

  function openInputDlg(title, body, hint, placeholder){
    dlgTitle.textContent = title;
    dlgBody.textContent = body;
    dlgHint.textContent = hint;
    dlgInput.placeholder = placeholder || 'ì…ë ¥...';
    dlgInput.value = '';
    dlgRow.style.display = 'flex';
    loadWrap.classList.remove('show');
    dlg.classList.add('show');
    setTimeout(() => dlgInput.focus(), 100);
  }

  function closeDlg(){
    dlg.classList.remove('show');
    loadWrap.classList.remove('show');
  }

  dlgClose.onclick = closeDlg;

  // Coin popup
  function showCoinPopup(){
    st.coins++;
    saveState();
    document.getElementById('coinCount').textContent = st.coins;

    const popup = document.createElement('div');
    popup.className = 'coin-popup';
    popup.textContent = 'ğŸª™ +1 COIN!';
    popup.style.left = '50%';
    popup.style.top = '40%';
    popup.style.transform = 'translateX(-50%)';
    document.getElementById('screenWrap').appendChild(popup);
    setTimeout(() => popup.remove(), 1500);
  }

  // Update buttons
  function updateButtons(){
    const profile = document.getElementById('btnProfile');
    const photo = document.getElementById('btnPhoto');
    const next = document.getElementById('btnNext');
    const status = document.getElementById('statusText');

    if(st.startCleared){
      profile.disabled = false;
      photo.disabled = false;
      next.disabled = false;
      status.textContent = 'ëª¨ë“  ë°©ì´ ì—´ë ¸ìŠµë‹ˆë‹¤!';
    } else {
      profile.disabled = true;
      photo.disabled = true;
      next.disabled = true;
      status.textContent = 'STARTë¥¼ í´ë¦¬ì–´í•˜ì„¸ìš”';
    }

    document.getElementById('coinCount').textContent = st.coins;
  }

  // Room actions
  const ANSWER_FLOOR = '4';
  const ANSWER_FLAG = 'FLAG{KYB}';

  function showStart(){
    if(st.startCleared){
      openDlg('âœ… CLEARED', 'ì´ë¯¸ í´ë¦¬ì–´í•œ ë°©ì…ë‹ˆë‹¤!\në‹¤ë¥¸ ë°©ì„ íƒí—˜í•˜ì„¸ìš”.');
      return;
    }
    openInputDlg(
      'ğŸšª START GATE',
      'WHITE_HACKERê°€ ê·¼ë¬´í•œ\nê±´ë¬¼ì˜ ì¸µì€?\n\n(ìˆ«ìë§Œ ì…ë ¥í•˜ì„¸ìš”)',
      'ì •ë‹µì„ ë§íˆë©´ ëª¨ë“  ë°©ì´ ì—´ë¦½ë‹ˆë‹¤.',
      'ì˜ˆ: 4'
    );

    dlgSubmit.onclick = () => {
      const v = dlgInput.value.trim();
      if(v === ANSWER_FLOOR){
        st.startCleared = true;
        saveState();
        showCoinPopup();
        updateButtons();
        openDlg(
          'âœ… ACCESS GRANTED!',
          'í™˜ì˜í•©ë‹ˆë‹¤!\nWHITE_HACKER ëª¨ë“œ í™œì„±í™”!\n\nğŸ”“ ëª¨ë“  ë°©ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.',
          'ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ë¥¸ ë°©ì„ íƒí—˜í•˜ì„¸ìš”.'
        );
      } else {
        dlgHint.textContent = 'âŒ í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.';
      }
    };
  }

  function showProfile(){
    dlgTitle.textContent = 'ğŸ“‹ PROFILE';
    dlgBody.innerHTML = `<span style="color:var(--pix);font-size:13px;font-weight:900;">â˜… WHITE_HACKER â˜…</span>
<span style="color:rgba(201,255,184,.5);font-size:9px;">FAREWELL QUEST ì£¼ì¸ê³µ</span>

<span style="color:rgba(201,255,184,.6);">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span style="color:var(--pixDim);">ì†Œì†:</span> ì„œìš¸ë‚¨ë¶€ì§€ë°©ê²€ì°°ì²­
<span style="color:var(--pixDim);">ë¶€ì„œ:</span> ê°€ìƒìì‚°í•©ë™ìˆ˜ì‚¬ë¶€
<span style="color:var(--pixDim);">ê¸°ê°„:</span> 2025.1.25 ~ 2026.1.23
<span style="color:rgba(201,255,184,.6);">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>

ğŸ† <span style="color:#f4b41a;">DFC 2023 ëŒ€ìƒ ìˆ˜ìƒì</span>

<span style="color:var(--pix);">ìš°ë¦¬ ë¶€ì„œì˜ ë“ ë“ í•œ ê¸°ìˆ  ë¸Œë ˆì¸!</span>
<span style="color:var(--pix);">ì–´ë ¤ìš´ ë¬¸ì œë„ ì²™ì²™, CTFë„ ì²™ì²™!</span>

<span style="color:rgba(201,255,184,.6);">ê·¸ë™ì•ˆ ì •ë§ ê³ ìƒí•˜ì…¨ìŠµë‹ˆë‹¤.</span>
<span style="color:rgba(201,255,184,.6);">ë‹¤ìŒ ìŠ¤í…Œì´ì§€ì—ì„œë„ í™”ì´íŒ…! ğŸ’š</span>`;
    dlgHint.textContent = '';
    dlgRow.style.display = 'none';
    loadWrap.classList.remove('show');
    dlg.classList.add('show');
  }

  function showPhoto(){
    if(st.photoCleared){
      showPhotoResult();
      return;
    }
    openInputDlg(
      'ğŸ“¸ PHOTO VAULT',
      'ë§¤ì£¼ ëª©ìš”ì¼, ì •ê¸° í…Œë‹ˆìŠ¤\nëª¨ì„ì˜ í´ëŸ½ ì´ë¦„ì€?\n\ní˜•ì‹: FLAG{CLUB}\n(ëŒ€ë¬¸ì ì•ŒíŒŒë²³ë§Œ)',
      'ì •ë‹µì„ ë§íˆë©´ ì‚¬ì§„ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.',
      'ì˜ˆ: FLAG{ABC}'
    );

    dlgSubmit.onclick = () => {
      const v = dlgInput.value.trim().toUpperCase();
      if(v === ANSWER_FLAG){
        st.photoCleared = true;
        saveState();
        showCoinPopup();
        showPhotoResult();
      } else if(!v.match(/^FLAG\{[A-Z]+\}$/)){
        dlgHint.textContent = 'âš ï¸ FLAG{...} í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”.';
      } else {
        dlgHint.textContent = 'âŒ WRONG FLAG. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.';
      }
    };
  }

  function showPhotoResult(){
    dlgTitle.textContent = 'ğŸ“¸ UNLOCKED!';
    dlgBody.innerHTML = 'âœ… ìˆ¨ê²¨ì§„ ì‚¬ì§„ì´ ê³µê°œë©ë‹ˆë‹¤!<br><br><img id="photoImg" src="s0uthern_v1rtual_mem0ry.JPG" style="width:100%;border-radius:8px;border:2px solid var(--pix);margin-top:8px;"><div id="photoError" style="display:none;color:var(--pixDim);font-size:10px;padding:20px;background:rgba(0,0,0,.3);border-radius:8px;text-align:center;">ğŸ“· ì‚¬ì§„ ë¡œë”© ì¤‘...<br><br>GitHubì— ì‚¬ì§„ íŒŒì¼ì„ ì˜¬ë ¸ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”!<br>íŒŒì¼ëª…: s0uthern_v1rtual_mem0ry.JPG</div>';
    dlgHint.textContent = 'í•¨ê»˜í•´ì„œ í–‰ë³µí–ˆìŠµë‹ˆë‹¤! ğŸ’š';
    dlgRow.style.display = 'none';
    loadWrap.classList.remove('show');
    dlg.classList.add('show');
    
    // ì´ë¯¸ì§€ ë¡œë“œ ì—ëŸ¬ ì²˜ë¦¬
    const img = document.getElementById('photoImg');
    const errDiv = document.getElementById('photoError');
    img.onerror = function(){
      img.style.display = 'none';
      errDiv.style.display = 'block';
    };
  }

  function showNext(){
    openDlg(
      'ğŸš€ NEXT STAGE',
      'ctftime.orgë¡œ ì´ë™í•©ë‹ˆë‹¤...',
      'ë¡œë”© ì¤‘...'
    );
    loadWrap.classList.add('show');
    loadBar.style.width = '0%';

    let progress = 0;
    const interval = setInterval(() => {
      progress += Math.random() * 15 + 5;
      if(progress >= 100){
        progress = 100;
        loadBar.style.width = '100%';
        clearInterval(interval);
        setTimeout(() => {
          window.location.href = 'https://ctftime.org';
        }, 300);
      } else {
        loadBar.style.width = progress + '%';
      }
    }, 100);
  }

  // Button events
  document.getElementById('btnStart').onclick = () => {
    walkTo(rooms.start, showStart);
  };
  document.getElementById('btnProfile').onclick = () => {
    if(!st.startCleared) return;
    walkTo(rooms.profile, showProfile);
  };
  document.getElementById('btnPhoto').onclick = () => {
    if(!st.startCleared) return;
    walkTo(rooms.photo, showPhoto);
  };
  document.getElementById('btnNext').onclick = () => {
    if(!st.startCleared) return;
    walkTo(rooms.next, showNext);
  };

  document.getElementById('btnReset').onclick = () => {
    st.startCleared = false;
    st.photoCleared = false;
    st.coins = 0;
    saveState();
    player.x = 4 * TILE;
    player.y = 3 * TILE;
    player.tx = 4;
    player.ty = 3;
    moving = false;
    path = [];
    updateButtons();
    closeDlg();
    openDlg('ğŸ”„ RESET', 'ì§„í–‰ ìƒíƒœê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nSTARTë¶€í„° ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.', '');
  };

  // Enter key for input
  dlgInput.addEventListener('keypress', (e) => {
    if(e.key === 'Enter') dlgSubmit.click();
  });

  // Render loop
  function render(){
    frameCount++;
    updateMovement();

    // Clear & draw floor
    drawFloor();

    // Draw rooms
    for(const [name, room] of Object.entries(rooms)){
      drawRoom(room, name);
    }

    // Draw center coin (decorative)
    drawCoin(W/2, H/2 - 20);

    // Draw player
    drawChar(player.x, player.y, player.dir, Math.floor(frameCount/8));

    // HUD
    ctx.fillStyle = 'rgba(201,255,184,.7)';
    ctx.font = '10px monospace';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'top';
    ctx.fillText(st.startCleared ? 'ğŸ”“ UNLOCKED' : 'ğŸ”’ LOCKED', 8, 8);

    requestAnimationFrame(render);
  }

  // Init
  updateButtons();
  render();

  // Welcome message
  if(!st.startCleared){
    openDlg(
      'ğŸ® WHITE_HACKER QUEST',
      'ì–´ì„œì˜¤ì„¸ìš”!\n\nSTART ë²„íŠ¼ì„ ëˆŒëŸ¬\nê´€ë¬¸ì„ í†µê³¼í•˜ì„¸ìš”.\n\nì •ë‹µì„ ë§íˆë©´ ì½”ì¸ì„ íšë“í•˜ê³ \në‹¤ë¥¸ ë°©ì´ ì—´ë¦½ë‹ˆë‹¤!',
      'ë²„íŠ¼ì„ ëˆŒëŸ¬ ìºë¦­í„°ë¥¼ ì´ë™ì‹œí‚¤ì„¸ìš”.'
    );
  }
})();
</script>
</body>
</html>
